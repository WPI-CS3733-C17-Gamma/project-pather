import javafx.fxml.FXML;
import javafx.scene.control.Button;
import javafx.scene.control.ToggleButton;
import javafx.scene.image.Image;
import javafx.scene.image.ImageView;
import javafx.scene.paint.*;
import javafx.scene.paint.Color;
import javafx.scene.shape.Circle;
import javafx.scene.shape.Line;

import java.awt.*;
import java.io.File;

public class MapAdminController extends DisplayController {
//    MapAdminDisplay display;
    GraphNode selectedNode;
    GraphNode secondaryNode;

    @FXML
    private Button buttonSave;
    @FXML
    private Button buttonCancel;
    @FXML
    private ToggleButton togglebuttonAddNode;
    @FXML
    private ToggleButton togglebuttonAddConnections;
    @FXML
    private ImageView imageviewMap;

    String mapName;

    /**
     *  Construct map admin controller
     * @param map all the data for the program
     * @param applicationController main controller
     * @param currentMap
     */
    public MapAdminController(Map map, ApplicationController applicationController, String currentMap) {
        super(map, applicationController, currentMap);
    }


    void update(){
        //needs to update the database with any changes

    }

    public void login(String credentials){
        //no need to worry about this for this iteration
    }

    /**
     * Create node from given location. Make new GraphNode
     * @param location location to create a point at
     */
    public void addNode(FloorPoint location){
        map.addNode(new GraphNode(location));
        Circle c = new Circle((double)location.getX(), (double)location.getY(), 4, Color.BLUE);
    }

    public void addNodeGraphically(){
        addNode(getMouseLocation());
    }

    /**
     * Given the user mouse click, return the node they selected
     * If it is outside an acceptable distance, do not select the node
     * @param loc location generated by mouse click
     * @return selected GraphNode
     */
    public GraphNode selectNode(FloorPoint loc){
        GraphNode selected = map.getGraphNode(loc);
        int acceptableDistance = 100; // if farther than 100 units, don't select point

        if (selected != null && selected.location.distance(loc) < acceptableDistance) {
            return selected;
        }
        else {
            return null;
        }
    }

    /**
     * Delete a node from graph and delete the node from the adjacent nodes
     * @param node
     */
    public void deleteNode(GraphNode node){

        map.deleteNode(node);
    }

    /**
     * Add connection from nodeA to nodeB and
     * from nodeB to nodeA
     * Does not add a connection if it already exists
     * @param nodeA
     * @param nodeB
     */
    public void addConnection(GraphNode nodeA, GraphNode nodeB){
        Line l = new Line(nodeA.location.getX(),nodeA.location.getY(), nodeB.location.getX(), nodeB.location.getY());
        l.setFill(Color.RED);
    }

    public void addConnectionGraphically(){

    }


    public void deleteConnection(GraphNode nodeA, GraphNode nodeB){
        //idk what to do about deleting this
    }

    private void setMap(String loc, String mapName){
        File file = new File(loc);
        Image map = new Image(file.toURI().toString());
        imageviewMap.setImage(map);
        this.mapName = mapName;
    }

    private void isClicked(){
        if (togglebuttonAddNode.isSelected()) {
            addNodeGraphically();
        }
    }

    private void isDragged(){
        if (togglebuttonAddConnections.isSelected()){

        }
    }

    private FloorPoint getMouseLocation(){
        PointerInfo a = MouseInfo.getPointerInfo();
        Point b = a.getLocation();

        return new FloorPoint(((int) b.getX()),(int) b.getY(),mapName); //don't need to adjust for resolution because resolution is 1150x625
    }

}
